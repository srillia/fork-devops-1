FROM openjdk:8-jre

MAINTAINER zhliang <zhangliang1024_job@126.com>

ARG PINPOINT_COLLECTOR_IP
ARG PINPOINT_PROFILER_SAMPLING_RATE

ADD docker/pinpoint-agent-2.1.0.tar.gz /pinpoint-agent
COPY docker/config-pinpoint-agent.sh /config-pinpoint-agent.sh
COPY docker/entrypoint.sh /entrypoint.sh

ENV PINPOINT_VERSION=2.1.0
ENV PINPOINT_COLLECTOR_IP=$PINPOINT_COLLECTOR_IP
ENV PINPOINT_PROFILER_SAMPLING_RATE=$PINPOINT_PROFILER_SAMPLING_RATE
ENV PINPOINT_PROFILER_TRANSPORT_MODULE=GRPC
ENV PINPOINT_SPRING_PROFILES=release
ENV PINPOINT_COLLECTOR_TCP_PORT=9994
ENV PINPOINT_COLLECTOR_STAT_PORT=9995
ENV PINPOINT_COLLECTOR_SPAN_PORT=9996
ENV PINPOINT_PROFILER_TRANSPORT_AGENT_COLLECTOR_PORT=9991
ENV PINPOINT_PROFILER_TRANSPORT_METADATA_COLLECTOR_PORT=9991
ENV PINPOINT_PROFILER_TRANSPORT_STAT_COLLECTOR_PORT=9992
ENV PINPOINT_PROFILER_TRANSPORT_SPAN_COLLECTOR_PORT=9993
ENV PINPOINT_DEBUG_LEVEL=INFO


RUN mv /pinpoint-agent/pinpoint-agent-2.1.0/* /pinpoint-agent/ \
  && rm -rf /pinpoint-agent/pinpoint-agent-2.1.0 \
  && chmod +x /config-pinpoint-agent.sh \
  && chmod +x /entrypoint.sh

CMD ["/entrypoint.sh"]
